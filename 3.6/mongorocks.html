

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', 'UA-343802-3', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>MongoRocks &#8212; Percona Server for MongoDB 3.6 Documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/material.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <link rel="shortcut icon" href="_static/percona_favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="Hot Backup" href="hot-backup.html" />
    <link rel="prev" title="Percona Memory Engine" href="inmemory.html" />
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WBVF48V');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WBVF48V"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  
   

  </head>
  <body dir=ltr
        data-md-color-primary=orange data-md-color-accent=grey>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#mongorocks" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.percona.com/software/documentation" title="Percona Server for MongoDB 3.6 Documentation"
           class="md-header-nav__button md-logo">
          
              <img src="_static/percona-logo.svg" height="26"
                   alt="Percona Server for MongoDB 3.6 Documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic"> <a href="https://www.percona.com/software/documentation">Percona Product Documentation</a></span>
          <span class="md-header-nav__topic"> MongoRocks </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/percona/psmdb-docs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    percona/psmdb-docs
  </div>
</a>
          </div>
        </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Versions</button>
    <div class="dropdown-content md-hero">
          <a title="3.6 (EOL)" href="https://docs.percona.com/percona-server-for-mongodb/3.6/">3.6 (EOL)</a>
      
          <a title="4.0 (EOL)" href="https://docs.percona.com/percona-server-for-mongodb/4.0/">4.0 (EOL)</a>
      
          <a title="4.2" href="https://docs.percona.com/percona-server-for-mongodb/4.2/">4.2</a>
      
          <a title="4.4" href="https://docs.percona.com/percona-server-for-mongodb/4.4/">4.4</a>
      
          <a title="5.0" href="https://docs.percona.com/percona-server-for-mongodb/5.0/">5.0</a>
      
          <a title="6.0" href="https://docs.percona.com/percona-server-for-mongodb/6.0/">6.0</a>
      
          <a title="Latest stable" href="https://docs.percona.com/percona-server-for-mongodb/latest/">Latest stable</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Percona Server for MongoDB 3.6 Documentation</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="Percona Server for MongoDB 3.6 Documentation" class="md-nav__button md-logo">
      
        <img src="_static/percona-logo.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="Percona Server for MongoDB 3.6 Documentation">Percona Server for MongoDB 3.6 Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/percona/psmdb-docs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    percona/psmdb-docs
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="comparison.html" class="md-nav__link">Feature Comparison</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="install/index.html" class="md-nav__link">Installing Percona Server for MongoDB</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="install/upgrade_from_mongodb.html" class="md-nav__link">Upgrading from MongoDB Community Edition</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="install/upgrade_from_34.html" class="md-nav__link">Upgrading from Version 3.4</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="inmemory.html" class="md-nav__link">Percona Memory Engine</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> MongoRocks </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">MongoRocks</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#mongorocks--page-root" class="md-nav__link">MongoRocks</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#using-mongorocks" class="md-nav__link">Using MongoRocks</a>
        </li>
        <li class="md-nav__item"><a href="#configuring-mongorocks" class="md-nav__link">Configuring MongoRocks</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/mongorocks.rst.txt">Show Source</a> </li>

    
    <li class="md-nav__item"><a class="md-nav__extra_link" href="https://github.com/percona/psmdb-docs/edit/3.6/source/mongorocks.rst" target="_blank">
    <i class="fa fa-github"></i>    Edit this page</a> </li>
   
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hot-backup.html" class="md-nav__link">Hot Backup</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="rate-limit.html" class="md-nav__link">Profiling Rate Limit</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="authentication.html" class="md-nav__link">External Authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="audit-logging.html" class="md-nav__link">Auditing</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="log-redaction.html" class="md-nav__link">Log Redaction</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="enable-auth.html" class="md-nav__link">Enabling Authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="data_at_rest_encryption.html" class="md-nav__link">Data at Rest Encryption</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ngram-full-text-search.html" class="md-nav__link">Additional text search algorithm - <em>ngram</em></a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="switch_storage_engines.html" class="md-nav__link">Switching Storage Engines</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="switch_storage_engines.html#data-at-rest-encryption" class="md-nav__link">Data at Rest Encryption</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="setParameter.html" class="md-nav__link">Parameter Tuning</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="contact.html" class="md-nav__link">Contacting, Contributing, Reporting Bugs</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="release_notes/index.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="glossary.html" class="md-nav__link">Glossary</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="copyright.html" class="md-nav__link">Copyright and Licensing Information</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="trademark-policy.html" class="md-nav__link">Trademark Policy</a>
      
    
    </li>
  </ul>
  

  <label class="md-nav__title md-nav__title--site" for="__drawer">
<a title="Download PDF Manual" onclick="_gaq.push(['b._trackEvent', 'Percona Server for MongoDB', 'Download', 'Download Manual Percona Server for MongoDB 3.6 ']);" href="https://learn.percona.com/download-percona-server-mongodb-3-6-manual" class="md-nav__link">Download PDF Manual <span class="glyphicon glyphicon-chevron-down"></span></a>
  </label>
</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#mongorocks--page-root" class="md-nav__link">MongoRocks</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#using-mongorocks" class="md-nav__link">Using MongoRocks</a>
        </li>
        <li class="md-nav__item"><a href="#configuring-mongorocks" class="md-nav__link">Configuring MongoRocks</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/mongorocks.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

    
    <li class="md-nav__item"><a class="md-nav__extra_link" href="https://github.com/percona/psmdb-docs/edit/3.6/source/mongorocks.rst" target="_blank">
    <i class="fa fa-github"></i>    Edit this page</a> </li>
   
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <div class="md-typeset" role="main">  
  <div class="alert alert-warning">  
    <p> This documentation is for the end of life version of Percona Server for MongoDB and is no longer supported. You may want to see the <a href="https://docs.percona.com/percona-server-for-mongodb/latest/">current</a> documentation.
    </p>
  </div>
 </div>

  
<span id="id1"></span><h1 id="mongorocks--page-root">MongoRocks<a class="headerlink" href="#mongorocks--page-root" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>MongoRocks is deprecated in Percona Server for MongoDB 3.6.</strong></p>
</div>
<p>MongoRocks is deprecated in <em>Percona Server for MongoDB</em> 3.6 and it will be fully removed in the
next major version of <em>Percona Server for MongoDB</em>. Feature compatibility version is set to 3.4 when
using <em>Percona Server for MongoDB</em> 3.6 with MongoRocks, so 3.6 features, such as retryable writes
and causal consistency, cannot be used. Additionally, read concern majority may
produce unreliable results.</p>
<p>If you are using MongoRocks with <em>Percona Server for MongoDB</em> 3.4 or older, we strongly encourage
you to migrate from MongoRocks to WiredTiger before upgrading to <em>Percona Server for MongoDB</em> 3.6.
Instructions on how to change storage engines are located in this Percona blog
post: <a class="reference external" href="https://www.percona.com/blog/2017/03/07/how-to-change-mongodb-storage-engines-without-downtime/">https://www.percona.com/blog/2017/03/07/how-to-change-mongodb-storage-engines-without-downtime/</a>.</p>
<p>If you install <em>Percona Server for MongoDB</em> 3.6 with the RocksDB storage engine, you will receive
the following error message when trying to start mongod:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[ERROR] There are known issues with MongoDB 3.6 and MongoRocks. To learn about these issues and how to enable MongoRocks with Percona Server for MongoDB 3.6, please read https://www.percona.com/doc/percona-server-for-mongodb/3.6/mongorocks.html, terminating
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>changing feature compatibility version to 3.6 when using MongoRocks
will produce the following error: <code class="docutils literal notranslate"><span class="pre">storage</span> <span class="pre">engine</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">support</span>
<span class="pre">upgrading</span> <span class="pre">featureCompatibilityVersion</span> <span class="pre">to</span> <span class="pre">3.6</span></code></p>
</div>
<p>To continue using <em>Percona Server for MongoDB</em> 3.6 with MongoRocks, use one of the following two
methods:</p>
<blockquote>
<div><p>Add <code class="docutils literal notranslate"><span class="pre">--useDeprecatedMongoRocks</span></code> to <code class="docutils literal notranslate"><span class="pre">mongod</span></code> startup options
Update the config file with the following parameter:</p>
</div></blockquote>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>storage:
engine: rocksdb
useDeprecatedMongoRocks: true
</pre></div>
</div>
<p><em>MongoRocks</em> is a storage engine for MongoDB
based on the <a class="reference external" href="http://rocksdb.org">RocksDB</a> key-value store optimized for fast storage.
It is developed by Facebook and designed to handle write-intensive workloads.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#using-mongorocks" id="id4">Using MongoRocks</a></p></li>
<li><p><a class="reference internal" href="#configuring-mongorocks" id="id5">Configuring MongoRocks</a></p></li>
</ul>
</div>
<p>The <em>MongoRocks</em> storage engine is available in <em>Percona Server for MongoDB</em>
along with the standard MongoDB engines
(the original <a class="reference external" href="https://docs.mongodb.org/manual/core/mmapv1/">MMAPv1</a> and the default <a class="reference external" href="https://docs.mongodb.org/manual/core/wiredtiger/">WiredTiger</a>),
as well as <a class="reference internal" href="inmemory.html#inmemory"><span class="std std-ref">Percona Memory Engine</span></a>.</p>

<h2 id="using-mongorocks"><a class="toc-backref" href="#id4">Using MongoRocks</a><a class="headerlink" href="#using-mongorocks" title="Permalink to this headline">¶</a></h2>
<p>As of version 3.2, <em>Percona Server for MongoDB</em> runs with <a class="reference external" href="https://docs.mongodb.org/manual/core/wiredtiger/">WiredTiger</a> by default.
If you still would like to use the deprecated <em>MongoRocks</em> storage
engine, please use the <code class="docutils literal notranslate"><span class="pre">--storageEngine</span> <span class="pre">rocksdb</span></code> command-line option
accompanied by <code class="docutils literal notranslate"><span class="pre">--useDeprecatedMongoRocks</span></code> when you start
<code class="docutils literal notranslate"><span class="pre">mongod</span></code>. Alternatively, you can set the <code class="docutils literal notranslate"><span class="pre">storage.engine</span></code> and
<code class="docutils literal notranslate"><span class="pre">useDeprecatedMongoRocks</span></code> variables in the configuration file (by
default, <code class="file docutils literal notranslate"><span class="pre">/etc/mongod.conf</span></code>) as shown below.</p>
<p>Data created by one storage engine
is not compatible with other storage engines,
because each one has its own data model.
When changing the storage engine, you have to do one of the following:</p>
<ul>
<li><p>If you simply want to temporarily test <em>MongoRocks</em>,
change to a different data directory with the <code class="docutils literal notranslate"><span class="pre">--dbpath</span></code>
command-line option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>service<span class="w"> </span>mongod<span class="w"> </span>stop
$<span class="w"> </span>mongod<span class="w"> </span>--storageEngine<span class="w"> </span>rocksdb<span class="w"> </span>--useDeprecatedMongoRocks<span class="w"> </span>--dbpath<span class="w"> </span>&lt;newDataDir&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that the user running <code class="docutils literal notranslate"><span class="pre">mongod</span></code>
has read and write permissions for the new data directory.</p>
</div>
</li>
<li><p>If you want to permanently switch to <em>MongoRocks</em>
and do not have any valuable data in your database,
clean out the default data directory and edit the configuration file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>service<span class="w"> </span>mongod<span class="w"> </span>stop
$<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/mongodb/*
$<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'/engine: .*rocksdb/s/#//g'</span><span class="w"> </span>/etc/mongod.conf
$<span class="w"> </span>service<span class="w"> </span>mongod<span class="w"> </span>start
</pre></div>
</div>
</li>
<li><p>If there is data that you want to migrate
and make compatible with <em>MongoRocks</em>,
use the <code class="docutils literal notranslate"><span class="pre">mongodump</span></code> and <code class="docutils literal notranslate"><span class="pre">mongorestore</span></code> utilities:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mongodump<span class="w"> </span>--out<span class="w"> </span>&lt;dumpDir&gt;
$<span class="w"> </span>service<span class="w"> </span>mongod<span class="w"> </span>stop
$<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/mongodb/*
$<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'/engine: .*rocksdb/s/#//g'</span><span class="w"> </span>/etc/mongod.conf
$<span class="w"> </span>service<span class="w"> </span>mongod<span class="w"> </span>start
$<span class="w"> </span>mongorestore<span class="w"> </span>&lt;dumpDir&gt;
</pre></div>
</div>
</li>
</ul>


<h2 id="configuring-mongorocks"><a class="toc-backref" href="#id5">Configuring MongoRocks</a><a class="headerlink" href="#configuring-mongorocks" title="Permalink to this headline">¶</a></h2>
<p>You can configure <em>MongoRocks</em> using either command-line options
or corresponding parameters in the <code class="file docutils literal notranslate"><span class="pre">/etc/mongod.conf</span></code> file.
The configuration file is formatted in YAML.
For example, the following sample configuration is suggested
as the default for running <em>Percona Server for MongoDB</em> with <em>MongoRocks</em>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>storage:
  engine: rocksdb
  useDeprecatedMongoRocks: true
  rocksdb:
    cacheSizeGB: 1
    compression: snappy
    maxWriteMBPerSec: 1024
    crashSafeCounters: false
    counters: true
    singleDeleteIndex: false
</pre></div>
</div>
<p>Setting parameters in the previous example configuration file
is the same as starting the <code class="docutils literal notranslate"><span class="pre">mongod</span></code> daemon with the following options:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mongod<span class="w"> </span>--storageEngine<span class="o">=</span>rocksdb<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--useDeprecatedMongoRocks<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--rocksdbCacheSizeGB<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--rocksdbCompression<span class="o">=</span>snappy<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--rocksdbMaxWriteMBPerSec<span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--rocksdbCrashSafeCounters<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--rocksdbCounters<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--rocksdbSingleDeleteIndex<span class="o">=</span><span class="nb">false</span>
</pre></div>
</div>
<p>The following options are available
(with corresponding YAML configuration file parameters):</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-rocksdbCacheSizeGB">
<span id="cmdoption-rocksdbcachesizegb"></span><span class="sig-name descname"><span class="pre">--rocksdbCacheSizeGB</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-rocksdbCacheSizeGB" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Variable</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">storage.rocksdb.cacheSizeGB</span></code></p>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>Integer</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p>30% of physical memory</p>
</dd>
</dl>
<p>Specifies the amount of memory (in gigabytes) to allocate for block cache.
Block cache is used to store uncompressed pages.
Compressed pages are stored in kernel’s page cache.</p>
<p>To configure block cache size dynamically,
set the <code class="docutils literal notranslate"><span class="pre">rocksdbRuntimeConfigCacheSizeGB</span></code> parameter at runtime:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">adminCommand</span><span class="p">({</span><span class="n">setParameter</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">rocksdbRuntimeConfigCacheSizeGB</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-rocksdbCompression">
<span id="cmdoption-rocksdbcompression"></span><span class="sig-name descname"><span class="pre">--rocksdbCompression</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-rocksdbCompression" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Variable</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">storage.rocksdb.compression</span></code></p>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>String</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">snappy</span></code></p>
</dd>
</dl>
<p>Specifies the block compression algorithm for data collection.
Possible values: <code class="docutils literal notranslate"><span class="pre">none</span></code>, <code class="docutils literal notranslate"><span class="pre">snappy</span></code>, <code class="docutils literal notranslate"><span class="pre">zlib</span></code>, <code class="docutils literal notranslate"><span class="pre">lz4</span></code>, <code class="docutils literal notranslate"><span class="pre">lz4hc</span></code>.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-rocksdbMaxWriteMBPerSec">
<span id="cmdoption-rocksdbmaxwritembpersec"></span><span class="sig-name descname"><span class="pre">--rocksdbMaxWriteMBPerSec</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-rocksdbMaxWriteMBPerSec" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Variable</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">storage.rocksdb.maxWriteMBPerSec</span></code></p>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>Integer</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">1024</span></code> (1 GB/sec)</p>
</dd>
</dl>
<p>Specifies the maximum speed at which <em>MongoRocks</em> writes to storage
(in megabytes per second).
Decrease this value to reduce read latency spikes during compactions.
However, reducing it too much might slow down writes.</p>
<p>To configure write speed dynamically,
set the <code class="docutils literal notranslate"><span class="pre">rocksdbRuntimeConfigMaxWriteMBPerSec</span></code> parameter at runtime:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">adminCommand</span><span class="p">({</span><span class="n">setParameter</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">rocksdbRuntimeConfigMaxWriteMBPerSec</span><span class="p">:</span><span class="mi">30</span><span class="p">})</span>
</pre></div>
</div>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-rocksdbCrashSafeCounters">
<span id="cmdoption-rocksdbcrashsafecounters"></span><span class="sig-name descname"><span class="pre">--rocksdbCrashSafeCounters</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-rocksdbCrashSafeCounters" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Variable</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">storage.rocksdb.crashSafeCounters</span></code></p>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>Boolean</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</dd>
</dl>
<p>Specifies whether to correct counters after a crash.
Enabling this can affect write performance.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-rocksdbCounters">
<span id="cmdoption-rocksdbcounters"></span><span class="sig-name descname"><span class="pre">--rocksdbCounters</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-rocksdbCounters" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Variable</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">storage.rocksdb.counters</span></code></p>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>Boolean</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p>
</dd>
</dl>
<p>Specifies whether to use advanced counters for <em>MongoRocks</em>.
You can disable them to improve write performance.</p>
</dd></dl>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-rocksdbSingleDeleteIndex">
<span id="cmdoption-rocksdbsingledeleteindex"></span><span class="sig-name descname"><span class="pre">--rocksdbSingleDeleteIndex</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-rocksdbSingleDeleteIndex" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Variable</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">storage.rocksdb.singleDeleteIndex</span></code></p>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>Boolean</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</dd>
</dl>
<p>This is an experimental feature.
Enable it only if you know what you are doing.</p>
</dd></dl>




          </article>
        </div>
      </div>
    </main>
  </div>
<div class="md-relbar2__inner md-grid">
<div class="md-content">
  <article class="md-content__inner md-typeset" role="main">    
    <h4>Contact Us </h4>
       <p>For free technical help, visit the Percona <a class="reference external" href="https://forums.percona.com/c/mongodb/percona-server-for-mongodb/17?utm_campaign=Doc%20pages" target="_blank">Community Forum</a>.<br>
        <p>To report bugs or submit feature requests, open a <a class="reference external" href="https://jira.percona.com/projects/PSMDB/issues/" target="_blank">JIRA</a> ticket.<br>
         <p>For paid <a class="reference external" href="https://www.percona.com/services/support"> support </a> and <a class="reference external" href="https://www.percona.com/services/managed-services"> managed </a> or <a class="reference external" href="https://www.percona.com/services/consulting">consulting services </a>, contact <a class="reference external" href="https://www.percona.com/about-percona/contact" target="_blank">Percona Sales</a>.</p>
 </article>
</div>
</div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="inmemory.html" title="Percona Memory Engine"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Percona Memory Engine </span>
              </div>
            </a>
          
          
            <a href="hot-backup.html" title="Hot Backup"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Hot Backup </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169;
                <a href="copyright.html">Copyright</a> Percona LLC and/or its affiliates 2015-2022.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>